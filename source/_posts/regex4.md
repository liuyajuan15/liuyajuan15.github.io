---
title: 正则表达式高级应用
date: 2017-09-18 10:34:54
tags: 正则表达式
categories: 正则表达式

---
### 一、环视（断言、零宽断言）
>以下内容参考《精通正则表达式》和[Zjmainstay学习笔记](http://www.zjmainstay.cn/my-regexp) 相关教程
>环视，在不同的地方又称之为零宽断言，简称断言。 
 环视强调的是它所在的**位置**，前面或者后面，必须满足环视表达式中的匹配情况，才能匹配成功。 
 环视可以认为是虚拟加入到它所在位置的附加判断条件，并不消耗正则的匹配字符。
 环视部分是不占宽度的，所以有零宽断言的叫法，所谓不占宽度就是：环视的匹配结果不纳入数据结果，环视它匹配过的地方，下次还能用它继续匹配
 用一句通俗的话解释： 
 环视，就是先从全局环顾一遍正则，（然后断定结果，）再做进一步匹配处理。 
 断言，就是先从全局环顾一遍正则，然后断定结果，再做进一步匹配处理。
 
#### 1.环视的类型
* 肯定顺序(?=exp) 匹配后面是exp的数据  a(?=b) 匹配后面是b的数据，即ab匹配，ac不匹配 ，匹配出来的结果是a
* 否定顺序(?!=exp) 匹配后面不是exp的数据 a(?!=b) 匹配后面不是b的数据，即ab不匹配，ac,ad,ae 等可以匹配，匹配出来的结果是a
* 肯定逆序(?<=exp) 匹配前面是exp的数据 (?<b)a 匹配前面是b的数据，即ba匹配，ca不匹配，匹配出来的结果是a
* 否定逆序(?<!exp) 匹配前面不是exp的数据 (?<!b)a 匹配前面不是b的数据，即ba不匹配，ca,da 等可以匹配，匹配出来的结果是a
**以上四个例子匹配出来的结果都是a,是因为环视强调的是它所在的位置，环视的匹配结果是不纳入数据结果的**

#### 2.简单环视过程
例如，对于源字符串ABC，正则(?=A)[A-Z]匹配的是:
1). (?=A)所在的位置，后面必须是A,下图红色虚线位置所示
2). 表达式[A-Z]匹配A-Z中任意一个字母 
根据两个的先后位置关系，组合在一起，那就是： 
(?=A)所在的位置，后面是A，而且是A-Z中任意一个字母，因此，上面正则表达式匹配一个大写字母A。
从例子可以看出，从左到右，正则分别匹配了环视(?=A)和[A-Z]，由于环视不消耗正则的匹配字符，因此，[A-Z]还能对A进行匹配，并得到结果。

![创建应用][id]
[id]: /img/regex2.png "简单环视"

#### 3.什么是消耗正则的匹配字符？
>文章开头提到正则的环视是不消耗正则的匹配字符，那么什么是消耗正则的匹配字符呢?
 正则是按单个字符匹配的，从左到右逐个匹配源字符串中的内容。
 
 **1).一次匹配消耗匹配字符匹配过程**
 
 a. 正则A：因为没有位置限定，因此是从源字符串开始位置开始，也就是正则里的^，这个^是虚拟字符，表示匹配字符串开始位置，也就是源字符串ABCAD里的A前面的位置，因为正则A能够匹配源字符串A，匹配成功，匹配位置从源字符串^的位置后移一位，到达A后面，即此时源字符串ABCAD的A这个字符已经被消耗，接下来的正则匹配从A后面开始。 
 
 b. 正则[A-Z]：当前匹配位置为第一个A字母后面位置，正则[A-Z]对源字符串ABCAD里的B字母进行匹配，匹配成功，位置后移到B字母后面的位置。至此，由于正则已经匹配完成，因此，正则A[A-Z]匹配结果是AB。
 
 我们知道，有些语言支持g模式修饰符，也就是全局匹配，那么，上面例子中，正则匹配1次成功之后，将会从匹配成功位置（B字母后面位置）开始，再从头进行匹配一次正则，直到源字符串全部消耗完为止。
 
 **2).多次匹配消耗匹配字符匹配过程**
 
 因此，全局匹配的过程补充如下： 
 c. 正则A：当前匹配位置为B字母后面位置，正则A去匹配源字符串中的C，匹配失败，匹配位置后移一位，此时C被消耗了。 
 
 d. 正则A：当前匹配位置为C字母后面位置，正则A去匹配源字符串中的第二个A字母，匹配成功，匹配位置后移一位，此时A被消耗了。 
 
 e. 正则[A-Z]：当前匹配位置为第二个A字母后面位置，正则[A-Z]对源字符串ABCAD里的D字母进行匹配，匹配成功，位置后移到D字母后面的位置，此时D被消耗了。

 f. 由于正则里还有个源字符串结束位置，也就是正则里的$，这个$也是虚拟字符，因此，还要继续进行匹配： 
 正则A：当前匹配位置为D字母后面的位置，正则A去匹配源字符串的结束位置，匹配失败，匹配结束。
 
 最终匹配结果是AB和AD。
 
 **3).不消耗匹配字符**
 
 需求：字母、数字组合，不区分大小写，不能纯数字或者纯字母，6-16个字符。
 通用正则：^[a-z0-9]{6,16}$    字母数字组合，6-16个字符
 排除纯字母：(?!^[a-z]+$)
 排除纯数字：(?!^[0-9]+$)
 组合起来：(?!^[a-z]+$)(?!^[0-9]+$)^[a-z0-9]{6,16}$
 
